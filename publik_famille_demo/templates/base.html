{% load static %}
<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Publik Famille Demo</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="{% static 'css/app.css' %}" rel="stylesheet">
  </head>
  <body class="grey lighten-4">
    <nav class="blue-grey darken-3">
      <div class="nav-wrapper container">
        <a href="{% url 'home' %}" class="brand-logo" style="display:flex;align-items:center;gap:.5rem;">
          {% if EO_LOGO_URL %}
            <img src="{{ EO_LOGO_URL }}" alt="Entr'ouvert" style="height:44px;vertical-align:middle;margin-right:6px">
          {% elif PUBLIK_LOGO_URL %}
            <img src="{{ PUBLIK_LOGO_URL }}" alt="Publik" style="height:44px;vertical-align:middle;margin-right:6px">
          {% else %}
            <i class="material-icons">home</i>
          {% endif %}
          <span>Publik Famille</span>
        </a>
        <a href="#" data-target="mobile-demo" class="sidenav-trigger"><i class="material-icons">menu</i></a>
        <ul class="right hide-on-med-and-down">
          {% if user.is_authenticated %}
            {% if user.is_staff %}
              <!-- Admin mode: show logs and admin only -->
              <li><a href="{% url 'monitoring:logs' %}"><i class="material-icons left">list</i>Logs</a></li>
              <li><a href="{% url 'admin:index' %}"><i class="material-icons left">settings</i>Admin</a></li>
            {% else %}
              <!-- User mode: show regular navigation links -->
              <li><a href="{% url 'families:child_list' %}"><i class="material-icons left">group</i>Mes enfants</a></li>
              <li><a href="{% url 'activities:list' %}"><i class="material-icons left">event</i>Activités</a></li>
              <li><a href="{% url 'activities:enrollments' %}"><i class="material-icons left">assignment</i>Mes inscriptions</a></li>
              <li><a href="{% url 'documents:list' %}"><i class="material-icons left">folder</i>Mes documents</a></li>
            {% endif %}
            <!-- Always show logout for authenticated users -->
            <li><a class="waves-effect" href="{% url 'logout' %}"><i class="material-icons left">logout</i>Se déconnecter</a></li>
          {% else %}
            <!-- Anonymous users: login link -->
            <li><a class="waves-effect" href="{% url 'login' %}"><i class="material-icons left">login</i>Se connecter</a></li>
          {% endif %}
        </ul>
      </div>
    </nav>

    <ul class="sidenav" id="mobile-demo">
      {% if user.is_authenticated %}
        {% if user.is_staff %}
          <!-- Admin mode mobile: show logs and admin only -->
          <li><a href="{% url 'monitoring:logs' %}">Logs</a></li>
          <li><a href="{% url 'admin:index' %}">Admin</a></li>
        {% else %}
          <!-- User mode mobile: show regular navigation -->
          <li><a href="{% url 'families:child_list' %}">Mes enfants</a></li>
          <li><a href="{% url 'activities:list' %}">Activités</a></li>
          <li><a href="{% url 'activities:enrollments' %}">Mes inscriptions</a></li>
          <li><a href="{% url 'documents:list' %}">Mes documents</a></li>
        {% endif %}
        <!-- Always show logout for authenticated users -->
        <li><a href="{% url 'logout' %}">Se déconnecter</a></li>
      {% else %}
        <!-- Anonymous users: login link -->
        <li><a href="{% url 'login' %}">Se connecter</a></li>
      {% endif %}
    </ul>

    <main class="container" style="min-height:60vh;">
      {% for message in messages %}
        {% if message.tags %}
          <div class="card-panel {{ message.tags|default:'blue' }} lighten-4">
            <span class="{{ message.tags|default:'blue-text' }} text-darken-2">{{ message }}</span>
          </div>
        {% else %}
          <div class="card-panel blue lighten-4">
            <span class="blue-text text-darken-2">{{ message }}</span>
          </div>
        {% endif %}
      {% endfor %}
      {% block content %}{% endblock %}
    </main>

    <footer class="page-footer blue-grey darken-3">
      <div class="container">
        <div class="row">
          <div class="col s12">
            <p class="grey-text text-lighten-4">Démo inspirée de Publik Famille — Django, Materialize CSS.</p>
          </div>
        </div>
      </div>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // Init menu latéral
        var sidenavElems = document.querySelectorAll('.sidenav');
        M.Sidenav.init(sidenavElems, {});
        // Init des <select> (sinon Materialize masque le select et le formulaire reste vide)
        var selectElems = document.querySelectorAll('select');
        M.FormSelect.init(selectElems, {});
      });
    </script>
  </body>
</html>
