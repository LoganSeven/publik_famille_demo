{% extends "authentic2/base-page.html" %}
{% load gadjo i18n static %}

{% block extra-top-head %}
  {{ block.super }}
  <link rel="stylesheet" type="text/css" href="{% static 'authentic2_idp_oidc/css/style.css' %}?{% start_timestamp %}"></link>
{% endblock %}

{% block title %}
  {% trans "Authentication access check" %}
{% endblock %}

{% block beforecontent %}
  {% include "authentic2/service_info_fragment.html" %}
{% endblock %}

{% block content %}
  <h2>{% trans "Authentication access check" %}</h2>
  <form method="post" id="a2-oidc-authorization-form">
    <p>{% trans "Do you want to be authenticated on this service?" %}</p>
    {% if needs_scope_validation %}
      <p>{% trans "The following information will be sent to the service:" %}</p>
      <ul>
        {% for scope in scopes %}
          {% if scope == "profile" %}
            <li>{% trans "Your first and last name, your username" %}</li>
          {% elif scope == "email" %}
            <li>{% trans "Your email:" %} {{ user.email }}</li>
          {% endif %}
        {% endfor %}
      </ul>
      {% if "offline_access" in scopes %}
        <p>{% translate "Additionally, this service needs to be given access to this information at any time while you are offline." %}</p>
      {% endif %}
    {% endif %}
    {% if client.activate_user_profiles and user_has_selectable_profiles %}
      <div id="profile-validation">
        <p>{% trans "You may authenticate as owner of the following juridical entity management profile, which may change the aforementioned information." %}</p>
        <div class="profile" id="profile-validation-none">
          <input type="radio" id="_none" name="profile-validation" value="" checked>
          <label for="_none">{% trans "Keep my default user profile." %}</label>
        </div>
        {% for profile in user.profiles.all %}
          <div class="profile" id="profile-validation-{{ profile.id }}">
            <input type="radio" id="{{ profile.id }}" name="profile-validation" value="{{ profile.id }}">
            <label for="{{ profile.id }}">
              {% with identifier=profile.identifier type_name=profile.profile_type.name %}
                {% trans "Unknown entity" as fallback_identifier %}
                {% blocktrans %}Profile of type {{ type_name }}: {% endblocktrans %}
                {% firstof identifier fallback_identifier %}<br />
              {% endwith %}
              {% if profile.email %}
                {% blocktrans with email=profile.email %}Email address: {{ email }}{% endblocktrans %}<br />
              {% endif %}</label>
          </div>
        {% endfor %}
      </div>
    {% endif %}
    {% csrf_token %}
    {% if not client.always_save_authorization and "offline_access" not in scopes %}
      <p class="a2-oidc-authorization-form--do-not-ask-again">
        <label for="id_do_not_ask_again"><input id="id_do_not_ask_again" type="checkbox" name="do_not_ask_again" value="on"/><span>{% trans "Do not ask again" %}</span></label>
      </p>
    {% endif %}
    <div class="buttons">
      <button name="accept">{% trans "Accept" %}</button>
      <button name="refuse">{% trans "Refuse" %}</button>
    </div>
  </form>
{% endblock %}
